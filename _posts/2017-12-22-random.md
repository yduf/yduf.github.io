---
title: Random fun (xoroshiro)
published: true
tags: random c++ math quote
---
> Le hasard souvent fait plus que la science. - [_Proverbe Français_](https://citations.ouest-france.fr/citation-proverbe-francais/hasard-souvent-fait-science-80598.html)

[![caption](https://thompsonsed.co.uk/wp-content/uploads/2019/03/prng_perf.jpg)](https://thompsonsed.co.uk/random-number-generators-for-c-performance-tested)

### [SplitMix64]

{% highlight cpp %}
uint64_t x{}; /* The state can be seeded with any value. */

uint64_t next()
{
    uint64_t z = (x += UINT64_C(0x9E3779B97F4A7C15));
    z = (z ^ (z >> 30)) * UINT64_C(0xBF58476D1CE4E5B9);
    z = (z ^ (z >> 27)) * UINT64_C(0x94D049BB133111EB);
    return z ^ (z >> 31);
}
{% endhighlight %}

### [xoroshiro128+](http://xoroshiro.di.unimi.it/) (XOR/shift/rotate) / [wikipedia](https://en.wikipedia.org/wiki/Xorshift#xorshift.2B)

> The lowest bits of the output generated by xoroshiro128+ have low quality. The authors of xoroshiro128+ acknowledge that it does not pass all statistical tests, stating: We suggest to use its upper bits for floating-point generation. 

> Xorshift128+ fails BigCrush when selecting the least significant 32 bits and reversing the bit order... The recommended replacement for xorshift128+, xoroshiro128+, also fails BigCrush in a similar manner... Xoroshiro is no faster than ... splitmix64  and ... passes BigCrush -   [The Xorshift128+ random number generator fails BigCrush](https://lemire.me/blog/2017/09/08/the-xorshift128-random-number-generator-fails-bigcrush/)


- [What is performance-wise the best way to generate random bools?]( https://stackoverflow.com/a/35358644/51386)

{% highlight cpp %}
#include <random>

random_device rd;
/* The state must be seeded so that it is not everywhere zero. */
uint64_t s[2] = { (uint64_t(rd()) << 32) ^ (rd()),
    (uint64_t(rd()) << 32) ^ (rd()) };

uint64_t xoroshiro128plus(void) {
    uint64_t x = s[0];
    uint64_t const y = s[1];
    s[0] = y;
    x ^= x << 23; // a
    s[1] = x ^ y ^ (x >> 17) ^ (y >> 26); // b, c
    return s[1] + y;
}
{% endhighlight %}

see also:
- [Modulo sampling]({% post_url 2022-09-19-math-rand-modulo %})
- [Pseudo-random number generation (C++11)](http://en.cppreference.com/w/cpp/numeric/random)
- [Random number generators for C++ performance tested](https://thompsonsed.co.uk/random-number-generators-for-c-performance-tested)
- [Vectorizing random number generators for greater speed](https://lemire.me/blog/2018/06/07/vectorizing-random-number-generators-for-greater-speed-pcg-and-xorshift128-avx-512-edition/)
- [“Cracking” random number generators (xoroshiro128+)](https://lemire.me/blog/2017/08/22/cracking-random-number-generators-xoroshiro128/) / [HN](https://news.ycombinator.com/item?id=15071833)
- [Better C++ Pseudo Random Number Generator](https://arvid.io/2018/07/02/better-cxx-prng/)