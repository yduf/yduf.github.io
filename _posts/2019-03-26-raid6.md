---
published: true
title: ZFS RAID
tags: raid nas
---
> Parity protection is a common technique for reliable data storage on mediums that may fail (HDDs, SSDs, storage servers, etc.) Calculation of parity uses tools from algebra in very interesting ways, in particular in the dual parity case. - [How RAID-6 dual parity calculation works](http://igoro.com/archive/how-raid-6-dual-parity-calculation-works/)

- [How to Choose the Best RAID Level for New Disk Array](https://www.stellarinfo.com/blog/how-to-choose-the-best-raid-level-for-new-disk-array/)

- [ZFS / RAIDZ Capacity Calculator](https://wintelguy.com/zfs-calc.pl)

## RAIDZ2 / RAID6

Fault-tolerant—can withstand up to any 2 disk failure from the array

[The minimum number of drives where RAID-Z2 makes sense is four](https://superuser.com/questions/1055145/how-many-drives-do-i-need-for-zfs-raid-z2/1058545#1058545)
, which gives you the effective storage capacity of two of the drives and allows losing any two of the drives. This is advantageous over using the same four drives in a 2x2 mirror setup, because if you have two mirror vdevs of two drives each and lose some combinations of two drives, that vdev is dead and takes the pool with it in its fiery demise.

If you want three drives ZFS, and want redundancy, set them up as a three-way mirror vdev.

- [RaidZ2 - 5 drives?](https://www.reddit.com/r/freenas/comments/bxozry/raidz2_5_drives/)

### [Growing ZFS can be inefficient and costly](https://butterwhat.com/2019/12/17/pats-nas-building-tips-and-rules-of-thumb.html#growing-zfs-can-be-inefficient-and-costly)

You can’t yet add disks to an existing ZFS zpool. If you create a RAID-Z2 with 6 disks, it will always have 6 disks.

You have two upgrade paths when you need more space. 
- You can replace all 6 disks with larger disks. You swap out one disk at a time, then let the RAID rebuild before swapping the next. After swapping the last disk, your zpool will automatically grow.

- You can also create a second zpool. You might do this by creating another RAID-Z2 with 6 more disks. When you do this, you will have two disks’ worth of redundancy in both RAID-Z2 arrays. This is a little wasteful.

## [RAIDZ / RAID5]({% post_url 2019-01-01-SHR %})

Fault-tolerant — Can withstand up to any 1 drive failure in the array.

## RAID 10

## [RAIDZ3](https://hardforum.com/threads/zfs-raid-z3-raidz3-recommended-drive-configuration.1621123/#post-1037485294)

4 and 5 disk RAID-Z3 pools seem small. 7 seems borderline (not much different than just going with RAID 1).

[The Solaris Internals Wiki](www.solarisinternals.com/wiki/index.php/ZFS_Best_Practices_Guide#RAIDZ_Configuration_Requirements_and_Recommendations) recommends that RAIDZ3 configurations should start with at least 8 drives (5+3)


## Note
- Your RAID 6 or RAID-Z2 array can lose any two disks without compromising your data. Your RAID 10 array is effectively built out of mirrored pairs. - [Choosing a RAID Configuration For Your Home Server](https://butterwhat.com/2019/05/23/choosing-a-raid-configuration-for-your-home-server.html)

- A resilver isn't more likely to kill an existing drive than a scrub. And the general advice is to do those semi regularly. - [HN](https://news.ycombinator.com/item?id=25360672)

- We (rsync.net) have several PB of raidz3 deployed all over the world. - [rsync](https://news.ycombinator.com/item?id=25360013) [HN](https://news.ycombinator.com/item?id=25358268) 
	- [You should use mirror vdevs, not RAIDZ](https://jrs-s.net/2015/02/06/zfs-you-should-use-mirror-vdevs-not-raidz/)